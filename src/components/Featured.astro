---
import Modal from "./Featured/Modal.astro";
import { getCollection } from "astro:content";

// Get all entries from a collection.
// Requires the name of the collection as an argument.
const projects = await getCollection("projects");
---

<section
  id="work"
  class="py-20 px-6 max-w-400 mx-auto flex flex-col items-center"
  transition:animate="fade"
>
  <div class="text-center mb-16">
    <div style="opacity: 1; transform: none;">
      <h2 class="font-heading text-4xl md:text-5xl text-primary mb-6">
        Featured Projects
      </h2>
    </div>
  </div>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8 w-3/4">
    {
      projects.map((project: { id: string, data: { images: string[]; client: string; year: number[]; title: string; blurb: string; }; }) => (
        <div>
          <div class="border-foreground/10 cursor-pointer h-130 text-foreground group overflow-hidden border-0 shadow-lg hover:shadow-2xl transition-all duration-500 bg-background rounded-2xl"
            onclick=`openModal("${project.id}")`
          >
            <div class="relative overflow-hidden">
              <img
                src=`${project.data.images[0]}`
                alt=`${project.data.title} project image`
                class="w-full h-64 object-cover group-hover:scale-110 transition-transform duration-700"
                width="400"
                data-dynamic="alt src"
              />
            </div>
            <div class="p-6">
              <div class="flex items-center justify-between mb-3">
                <div
                  class="inline-flex items-center rounded-md border px-2.5 py-1.5 text-xs font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-soft-peach text-primary font-paragraph"
                  data-dynamic="className"
                >
                  {project.data.client}
                </div>
                <div
                  class="flex items-center text-primary/60 text-sm"
                  data-dynamic="text"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="h-4 w-4 mr-1"
                  >
                    <>
                      <path d="M8 2v4" />
                      <path d="M16 2v4" />
                      <rect width="18" height="18" x="3" y="4" rx="2" />
                      <path d="M3 10h18" />
                    </>
                  </svg>
                  {project.data.year.join('-')}
                </div>
              </div>
              <h3
                class="font-heading text-xl text-primary mb-2 group-hover:text-secondary transition-colors"
                data-dynamic="text"
              >
                {project.data.title}
              </h3>
              <p
                class="font-paragraph text-primary/80 text-sm leading-relaxed"
                data-dynamic="text"
              >
                {project.data.blurb}
              </p>
            </div>
          </div>
        </div>
      ))
    }
  </div>
  <Modal projects={projects} />
</section>
